<link rel="stylesheet" type="text/css" href="../../css/base.css" />
<link rel="icon" type="image/png" href="../../images/icon.png" />

<div id="logo">
	<a href="http://mysterybox.orchestra.io/index/pages"><img src="../../images/logo.png" alt="" /></a>
</div>

<script type="text/javascript" src="../../js/jquery-1.6.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.jsmovie.1.4.1.min.js" ></script>

	<script>
		jQuery.preloadImages = function () {
		    var images = (typeof arguments[0] == 'object') ? arguments[0] : arguments;
		    for (var i = 0; i < images.length; i++) {
		        jQuery("<img>").attr("src", images[i]);
		    }
		};
			
		$(document).ready(function(){
			$('#advertisement').jsMovie({
				sequence : "seq##.jpg",    //the #### will be replaced with 0001,0002,0003,...
				folder   : "../../images/sequ/",       //this is the path where the script can find the image sequence
				from     : 0,               //the #### will start to replace with 0001
				to       : 50,              //the #### will start to replace with 0040
				width    : 640,             //the advertisement container will be resized to a width of 320px
				height   : 480,             //the advertisement container will be resized to a height of 150px
				showPreLoader : true,       //we do want to see a preloader animation
				playOnLoad : false,         //we don't want to have the movie play after the images have been loaded automatically
				// the preloader animation is located in the folder "img/loader.png"
				// it is a 4x4 image matrix with each image of 40px by 40px
				loader   : {path:"../../images/loader.png",height:40,width:40,rows:4,columns:4},
				fps: 10
			});

			$.preloadImages("../../images/postcard.png");
			<?php if ($this->entry != null && $this->entry->id != null) {?>
				$.preloadImages("<?php echo $this->entry->fileName ?>");
			<?php }?>
						
			$('#advertisement').bind("playing",function(){
				$('#framedisplay').text($(this).data("currentFrame").data("frame")+"/50"); 
			});			
			// make frame 1 to frame 20 to a clip an call it Hello. Pause the animation for 2 seconds before the next clip is being played
			$('#advertisement').jsMovie("addClip","Idle",1,15,2000);
			$('#advertisement').jsMovie("addClip","Open",16,40,2000);
			$('#advertisement').jsMovie("addClip","Close",41,50,2000);
			// play both the clips
			$('#advertisement').jsMovie("playClip", 0);

		});	
	</script>	

<div class="table-ornament-top">
</div>

<div class="table">	
	<br/>
<?php if ($this->entry != null && $this->entry->id != null) {?>	
	
	<?php 
	
		$exp_date = "2006-01-16"; 
		$todays_date = date("Y-m-d"); 
		$today = strtotime($todays_date);
		$expiration_date = strtotime($this->entry->unlockDate);
	 
		//if ($expiration_date > $today) { $valid = "yes"; } else { $valid = "no"; }	
	?>
	
	<?php if ($expiration_date < $today) {?>

		<div id="unlockDateMessage">
		<center>
		View your mystery on <?php echo $this->entry->unlockDate; ?>
		</center>		
		</div>
			
	<?php } else { ?>

	<div id="question">
	<center>
		<div id="advertisement">
		<!-- div id="framedisplay">0/48</div><span>0..10-idle; 10..29-open; 29..48-close </span-->
		</div>
	</center>		
	</div>
	
	<center>	
	<div id="card" style="display: none">
		<table width="640" height="480" class="postcard">
			<tr align="center">
				<!-- TODO put message title in span -->
				<td height="52"><span class="message-title-text"><?php echo $this->entry->messageTitle ?></span></td>
			</tr>
			<tr align="center">
				<!-- TODO put file link in src -->
				<td height="288"><img src='http://<?php echo $this->entry->fileName ?>' height="288px"/></td>
			</tr>
			<tr valign="top">
				<!-- TODO put message body in span -->
				<td height="128" class="message-body"><span class="message-body-text"><?php echo $this->entry->messageBody ?></span></td>
			</tr>
		</table>
		
		<center><button id="close" class="input-button" >Close</button></center>
	</div>
	</center>
	
	<div class="row" id="question-area">		
		<form action="" method="post">
			<p class="question-text" align="center"><?php echo $this->entry->riddleQuestion ?></p>
			<center>
				<input type="text" name="name" id="name" placeholder="Your answer" value=""  class="input-field"/>
				<button type="submit" id="submit" class="input-button">RIGHT!</button>
			</center>
			<br/>
			<center><span id="error" style="display: none; color: red">Nope... try again</span></center>
		</form>
	
		<script>
			$("#close").click(function() {
				$("#card").hide();
				$("#question").show();
				$('#advertisement').unbind("ended");
				$("#advertisement").jsMovie("playClip", 2);
				$('#advertisement').bind("ended", function(){
					//$("form").show();
					$("#question").hide();
					$("#advertisement").hide();
					//$("#advertisement").jsMovie("option", "repeat", true);
					//$("#advertisement").jsMovie("playClip", 0);
				});
			});
		
			$("#submit").click(function() {
				$("#error").hide();
				if ($("#name").val().toLowerCase() == "<?php echo $this->entry->riddleAnswer ?>".toLowerCase())
				{
					$("#advertisement").jsMovie("option", "repeat", false);
					$("#advertisement").jsMovie("playClip", 1);
					$("form").hide();
					$('#advertisement').unbind("ended");
					$('#advertisement').bind("ended", function(){
						//alert("asdf");						
						$("#question").hide();
						$("#card").show();
					});
				}
				else
				{
					$("#error").show();
				}
				
				return false;
			});			
		</script>
	</div>

	<?php } ?>		
<?php } ?>		


</div>

<div class="table-ornament-bottom">
</div>
<!-- Keep background behind content -->
<div id="background">
    <img src="../../images/background.png" class="stretch" alt="" />
</div>

